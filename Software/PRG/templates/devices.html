{% extends "base.html" %}

{% block title %}Geräteliste - Benning Device Manager{% endblock %}

{% block content %}
<div class="toolbar">
    <div style="display: flex; gap: 1rem; justify-content: space-between; align-items: center;">
        <h2 style="background: linear-gradient(135deg, #d4a5a5 0%, #d4af37 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            <i class="fas fa-list"></i> Geräteliste
        </h2>
        
        <div style="display: flex; gap: 1rem;">
            <a href="/quick-add" class="btn-primary">
                <i class="fas fa-plus"></i> Neues Gerät
            </a>
            <button class="btn-print" onclick="printPage()">
                <i class="fas fa-print"></i> Drucken
            </button>
            <a href="/pdf/devices" class="btn-danger" target="_blank">
                <i class="fas fa-file-pdf"></i> PDF
            </a>
        </div>
    </div>
</div>

<!-- Filter und Suche -->
<div class="detail-card" style="margin-bottom: 2rem;">
    <div class="form-group">
        <label for="searchInput">
            <i class="fas fa-search"></i> Suche nach Geräte-ID, Kundenname oder Gerätenamen
        </label>
        <input type="text" id="searchInput" placeholder="Suchbegriff eingeben..." 
               style="width: 100%; padding: 0.75rem; background: var(--bg-card); border: 1px solid rgba(212, 165, 165, 0.3); border-radius: 8px; color: var(--text-primary);">
    </div>
</div>

<!-- Gerätetabelle -->
{% if devices %}
<table class="device-table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Kunde</th>
            <th>Geräte-ID</th>
            <th>Name</th>
            <th>Typ</th>
            <th>Seriennummer</th>
            <th>Standort</th>
            <th>Status</th>
            <th>QR-Code</th>
            <th>Aktionen</th>
        </tr>
    </thead>
    <tbody id="deviceTableBody">
        {% for device in devices %}
        <tr class="device-row" data-search="{{ device.customer|lower }} {{ device.name|lower }} {{ device.customer_device_id|lower }}">
            <td>{{ device.id }}</td>
            <td>{{ device.customer }}</td>
            <td><strong>{{ device.customer_device_id }}</strong></td>
            <td>{{ device.name }}</td>
            <td>{{ device.type }}</td>
            <td>{{ device.serial_number if device.serial_number else 'N/A' }}</td>
            <td>{{ device.location if device.location else 'N/A' }}</td>
            <td>
                {% if device.status == 'active' %}
                    <span class="badge badge-active"><i class="fas fa-check-circle"></i> Aktiv</span>
                {% elif device.status == 'inactive' %}
                    <span class="badge" style="background: rgba(158, 158, 158, 0.2); color: #9e9e9e;"><i class="fas fa-pause-circle"></i> Inaktiv</span>
                {% elif device.status == 'maintenance' %}
                    <span class="badge" style="background: rgba(255, 193, 7, 0.2); color: #ffc107;"><i class="fas fa-tools"></i> Wartung</span>
                {% elif device.status == 'retired' %}
                    <span class="badge badge-failed"><i class="fas fa-times-circle"></i> Außer Betrieb</span>
                {% else %}
                    <span class="badge">{{ device.status }}</span>
                {% endif %}
            </td>
            <td style="text-align: center;">
                {% if device.qr_code %}
                    <img src="{{ device.qr_code }}" alt="QR-Code" style="width: 50px; height: 50px; border: 1px solid var(--accent-rose); border-radius: 4px;">
                {% else %}
                    <span style="color: var(--text-secondary);">-</span>
                {% endif %}
            </td>
            <td>
                <a href="/device/{{ device.id }}" class="btn-small">
                    <i class="fas fa-eye"></i> Details
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Statistiken -->
<div class="stats-grid" style="margin-top: 2rem;">
    <div class="stat-card">
        <h3 id="totalDevices">{{ devices|length }}</h3>
        <p>Gesamtgeräte</p>
    </div>
    <div class="stat-card">
        <h3 id="activeDevices">{{ devices|selectattr('status', 'equalto', 'active')|list|length }}</h3>
        <p>Aktive Geräte</p>
    </div>
    <div class="stat-card">
        <h3 id="maintenanceDevices">{{ devices|selectattr('status', 'equalto', 'maintenance')|list|length }}</h3>
        <p>In Wartung</p>
    </div>
    <div class="stat-card warning">
        <h3 id="retiredDevices">{{ devices|selectattr('status', 'equalto', 'retired')|list|length }}</h3>
        <p>Außer Betrieb</p>
    </div>
</div>

{% else %}
<div class="detail-card" style="text-align: center; padding: 3rem;">
    <i class="fas fa-inbox" style="font-size: 3rem; color: var(--accent-rose); margin-bottom: 1rem;"></i>
    <h3>Keine Geräte vorhanden</h3>
    <p style="color: var(--text-secondary); margin-top: 1rem;">
        Es wurden noch keine Geräte erfasst. 
        <a href="/quick-add" style="color: var(--accent-gold); text-decoration: none;">
            <strong>Klicken Sie hier, um ein neues Gerät hinzuzufügen.</strong>
        </a>
    </p>
    <a href="/quick-add" class="btn-primary" style="margin-top: 1rem;">
        <i class="fas fa-plus"></i> Neues Gerät
    </a>
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
    // Suchfunktion
    document.getElementById('searchInput').addEventListener('keyup', function() {
        const searchTerm = this.value.toLowerCase();
        const rows = document.querySelectorAll('.device-row');
        
        rows.forEach(row => {
            const searchText = row.getAttribute('data-search');
            if (searchText.includes(searchTerm)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
    
    // Print-Funktion
    function printPage() {
        window.print();
    }
</script>
{% endblock %}
