{% extends "base.html" %}

{% block title %}Dashboard - Benning Device Manager{% endblock %}

{% block content %}
{% extends "base.html" %}

<div class="dashboard">
    <h2>üìä Dashboard</h2>
    
    {% if error %}
    <div class="alert alert-danger">‚ö†Ô∏è Fehler: {{ error }}</div>
    {% endif %}
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üì¶</div>
            <div class="stat-content">
                <h3>{{ total_devices }}</h3>
                <p>Gesamtzahl Ger√§te</p>
            </div>
        </div>
        <div class="stat-card success">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-content">
                <h3>{{ active_devices }}</h3>
                <p>Bestanden</p>
            </div>
        </div>
        <div class="stat-card danger">
            <div class="stat-icon">‚ùå</div>
            <div class="stat-content">
                <h3>{{ failed_devices }}</h3>
                <p>Nicht bestanden</p>
            </div>
        </div>
        <div class="stat-card warning">
            <div class="stat-icon">üî¥</div>
            <div class="stat-content">
                <h3>{{ lost_devices }}</h3>
                <p>Verloren</p>
            </div>
        </div>
    </div>
    
    <div class="chart-section">
        <h3>üìà Pr√ºfstatistiken</h3>
        <canvas id="inspectionChart" width="400" height="200"></canvas>
    </div>
    
    <div class="recent-section">
        <div class="section-header">
            <h3>üìã Zuletzt hinzugef√ºgt</h3>
            <a href="{{ url_for('devices') }}" class="btn-small">Alle ansehen ‚Üí</a>
        </div>
        
        {% if recent_devices %}
        <table class="device-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Typ</th>
                    <th>Status</th>
                    <th>Aktionen</th>
                </tr>
            </thead>
            <tbody>
                {% for device in recent_devices %}
                <tr>
                    <td><strong>{{ device.customer_device_id }}</strong></td>
                    <td>{{ device.name }}</td>
                    <td>{{ device.type }}</td>
                    <td><span class="badge badge-{{ device.status }}">{{ device.status }}</span></td>
                    <td><a href="{{ url_for('device_detail', device_id=device.id) }}" class="btn-small">Details</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="alert alert-info">‚ÑπÔ∏è Keine Ger√§te vorhanden. <a href="{{ url_for('quick_add') }}">Neues Ger√§t erstellen</a></div>
        {% endif %}
    </div>
    
    <div class="quick-actions">
        <h3>üöÄ Schnellaktionen</h3>
        <div class="action-buttons">
            <a href="{{ url_for('quick_add') }}" class="btn btn-primary">‚ûï Neues Ger√§t</a>
            <a href="{{ url_for('devices') }}" class="btn btn-secondary">üìã Alle Ger√§te</a>
            <a href="{{ url_for('usbc_inspections') }}" class="btn btn-secondary">üîå USB-C Pr√ºfungen</a>
        </div>
    </div>
</div>

<style>
.dashboard { padding: 20px; }
.dashboard h2 { margin-top: 0; color: #333; }
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
.stat-card { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s; }
.stat-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
.stat-card.success { border-left: 4px solid #28a745; }
.stat-card.danger { border-left: 4px solid #dc3545; }
.stat-card.warning { border-left: 4px solid #6c757d; }
.stat-icon { font-size: 32px; min-width: 50px; }
.stat-content h3 { margin: 0; font-size: 28px; color: #333; }
.stat-content p { margin: 5px 0 0 0; color: #666; font-size: 14px; }
.chart-section { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.chart-section h3 { margin-top: 0; }
.recent-section { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.section-header h3 { margin: 0; }
.device-table { width: 100%; border-collapse: collapse; }
.device-table thead { background-color: #f8f9fa; }
.device-table th { padding: 12px; text-align: left; font-weight: 600; border-bottom: 2px solid #dee2e6; }
.device-table td { padding: 12px; border-bottom: 1px solid #dee2e6; }
.device-table tbody tr:hover { background-color: #f8f9fa; }
.badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; }
.badge-active { background-color: #d4edda; color: #155724; }
.badge-false { background-color: #f8d7da; color: #721c24; }
.badge-lost { background-color: #e2e3e5; color: #383d41; }
.quick-actions { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.quick-actions h3 { margin-top: 0; }
.action-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
.btn { padding: 10px 20px; border-radius: 4px; text-decoration: none; display: inline-block; transition: all 0.2s; border: none; cursor: pointer; }
.btn-primary { background-color: #007bff; color: white; }
.btn-primary:hover { background-color: #0056b3; }
.btn-secondary { background-color: #6c757d; color: white; }
.btn-secondary:hover { background-color: #545b62; }
.btn-small { padding: 6px 12px; font-size: 12px; background-color: #007bff; color: white; text-decoration: none; border-radius: 4px; display: inline-block; }
.btn-small:hover { background-color: #0056b3; }
.alert { padding: 12px 16px; margin-bottom: 20px; border-radius: 4px; border-left: 4px solid; }
.alert-danger { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
.alert-info { background-color: #d1ecf1; color: #0c5460; border-color: #bee5eb; }
</style>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', ( ) => {
    const ctx = document.getElementById('inspectionChart').getContext('2d');
    const active = {{ active_devices }};
    const failed = {{ failed_devices }};
    const lost = {{ lost_devices }};
    
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Bestanden', 'Nicht bestanden', 'Verloren'],
            datasets: [{
                data: [active, failed, lost],
                backgroundColor: ['#28a745', '#dc3545', '#6c757d'],
                borderColor: ['#fff', '#fff', '#fff'],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15,
                        font: { size: 14 }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percent = ((context.parsed / total) * 100).toFixed(1);
                            return context.label + ': ' + context.parsed + ' (' + percent + '%)';
                        }
                    }
                }
            }
        }
    });
});
</script>
{% endblock %}



{% block content %}
<div class="dashboard">
    <h2>üìä Dashboard</h2>
    
    {% if error %}
    <div class="alert alert-danger">‚ö†Ô∏è Fehler: {{ error }}</div>
    {% endif %}
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üì¶</div>
            <div class="stat-content">
                <h3>{{ total_devices }}</h3>
                <p>Gesamtzahl Ger√§te</p>
            </div>
        </div>
        <div class="stat-card success">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-content">
                <h3>{{ active_devices }}</h3>
                <p>Bestanden</p>
            </div>
        </div>
        <div class="stat-card danger">
            <div class="stat-icon">‚ùå</div>
            <div class="stat-content">
                <h3>{{ failed_devices }}</h3>
                <p>Nicht bestanden</p>
            </div>
        </div>
        <div class="stat-card warning">
            <div class="stat-icon">üî¥</div>
            <div class="stat-content">
                <h3>{{ lost_devices }}</h3>
                <p>Verloren</p>
            </div>
        </div>
    </div>
    
    <div class="chart-section">
        <h3>üìà Pr√ºfstatistiken</h3>
        <canvas id="inspectionChart" width="400" height="200"></canvas>
    </div>
    
    <div class="recent-section">
        <div class="section-header">
            <h3>üìã Zuletzt hinzugef√ºgt</h3>
            <a href="{{ url_for('devices') }}" class="btn-small">Alle ansehen ‚Üí</a>
        </div>
        
        {% if recent_devices %}
        <table class="device-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Typ</th>
                    <th>Status</th>
                    <th>Aktionen</th>
                </tr>
            </thead>
            <tbody>
                {% for device in recent_devices %}
                <tr>
                    <td><strong>{{ device.customer_device_id }}</strong></td>
                    <td>{{ device.name }}</td>
                    <td>{{ device.type }}</td>
                    <td><span class="badge badge-{{ device.status }}">{{ device.status }}</span></td>
                    <td><a href="{{ url_for('device_detail', device_id=device.id) }}" class="btn-small">Details</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="alert alert-info">‚ÑπÔ∏è Keine Ger√§te vorhanden. <a href="{{ url_for('quick_add') }}">Neues Ger√§t erstellen</a></div>
        {% endif %}
    </div>
    
    <div class="quick-actions">
        <h3>üöÄ Schnellaktionen</h3>
        <div class="action-buttons">
            <a href="{{ url_for('quick_add') }}" class="btn btn-primary">‚ûï Neues Ger√§t</a>
            <a href="{{ url_for('devices') }}" class="btn btn-secondary">üìã Alle Ger√§te</a>
            <a href="{{ url_for('usbc_inspections') }}" class="btn btn-secondary">üîå USB-C Pr√ºfungen</a>
        </div>
    </div>
</div>

<style>
.dashboard { padding: 20px; }
.dashboard h2 { margin-top: 0; color: #333; }
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
.stat-card { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s; }
.stat-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
.stat-card.success { border-left: 4px solid #28a745; }
.stat-card.danger { border-left: 4px solid #dc3545; }
.stat-card.warning { border-left: 4px solid #6c757d; }
.stat-icon { font-size: 32px; min-width: 50px; }
.stat-content h3 { margin: 0; font-size: 28px; color: #333; }
.stat-content p { margin: 5px 0 0 0; color: #666; font-size: 14px; }
.chart-section { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.chart-section h3 { margin-top: 0; }
.recent-section { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.section-header h3 { margin: 0; }
.device-table { width: 100%; border-collapse: collapse; }
.device-table thead { background-color: #f8f9fa; }
.device-table th { padding: 12px; text-align: left; font-weight: 600; border-bottom: 2px solid #dee2e6; }
.device-table td { padding: 12px; border-bottom: 1px solid #dee2e6; }
.device-table tbody tr:hover { background-color: #f8f9fa; }
.badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; }
.badge-active { background-color: #d4edda; color: #155724; }
.badge-false { background-color: #f8d7da; color: #721c24; }
.badge-lost { background-color: #e2e3e5; color: #383d41; }
.quick-actions { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.quick-actions h3 { margin-top: 0; }
.action-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
.btn { padding: 10px 20px; border-radius: 4px; text-decoration: none; display: inline-block; transition: all 0.2s; border: none; cursor: pointer; }
.btn-primary { background-color: #007bff; color: white; }
.btn-primary:hover { background-color: #0056b3; }
.btn-secondary { background-color: #6c757d; color: white; }
.btn-secondary:hover { background-color: #545b62; }
.btn-small { padding: 6px 12px; font-size: 12px; background-color: #007bff; color: white; text-decoration: none; border-radius: 4px; display: inline-block; }
.btn-small:hover { background-color: #0056b3; }
.alert { padding: 12px 16px; margin-bottom: 20px; border-radius: 4px; border-left: 4px solid; }
.alert-danger { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
.alert-info { background-color: #d1ecf1; color: #0c5460; border-color: #bee5eb; }
</style>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', ( ) => {
    const ctx = document.getElementById('inspectionChart').getContext('2d');
    const active = {{ active_devices }};
    const failed = {{ failed_devices }};
    const lost = {{ lost_devices }};
    
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Bestanden', 'Nicht bestanden', 'Verloren'],
            datasets: [{
                data: [active, failed, lost],
                backgroundColor: ['#28a745', '#dc3545', '#6c757d'],
                borderColor: ['#fff', '#fff', '#fff'],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15,
                        font: { size: 14 }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percent = ((context.parsed / total) * 100).toFixed(1);
                            return context.label + ': ' + context.parsed + ' (' + percent + '%)';
                        }
                    }
                }
            }
        }
    });
});
</script>
{% endblock %}

<style>
.dashboard {
    padding: 20px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.stat-card.warning {
    border-left: 4px solid #ffc107;
}

.stat-icon {
    font-size: 32px;
    min-width: 50px;
}

.stat-content h3 {
    margin: 0;
    font-size: 28px;
    color: #333;
}

.stat-content p {
    margin: 5px 0 0 0;
    color: #666;
    font-size: 14px;
}

.recent-section {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.section-header h3 {
    margin: 0;
}

.quick-actions {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.quick-actions h3 {
    margin-top: 0;
}

.action-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.btn {
    padding: 10px 20px;
    border-radius: 4px;
    text-decoration: none;
    display: inline-block;
    transition: all 0.2s;
    border: none;
    cursor: pointer;
}

.btn-primary {
    background-color: #007bff;
    color: white;
}

.btn-primary:hover {
    background-color: #0056b3;
}

.btn-secondary {
    background-color: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background-color: #545b62;
}

.alert {
    padding: 12px 16px;
    margin-bottom: 20px;
    border-radius: 4px;
    border-left: 4px solid;
}

.alert-danger {
    background-color: #f8d7da;
    color: #721c24;
    border-color: #f5c6cb;
}

.alert-info {
    background-color: #d1ecf1;
    color: #0c5460;
    border-color: #bee5eb;
}

.device-table {
    width: 100%;
    border-collapse: collapse;
}

.device-table thead {
    background-color: #f8f9fa;
}

.device-table th {
    padding: 12px;
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid #dee2e6;
}

.device-table td {
    padding: 12px;
    border-bottom: 1px solid #dee2e6;
}

.device-table tbody tr:hover {
    background-color: #f8f9fa;
}

.badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
}

.badge-active {
    background-color: #d4edda;
    color: #155724;
}

.badge-inactive {
    background-color: #e2e3e5;
    color: #383d41;
}

.badge-maintenance {
    background-color: #fff3cd;
    color: #856404;
}

.btn-small {
    padding: 6px 12px;
    font-size: 12px;
    background-color: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    display: inline-block;
}

.btn-small:hover {
    background-color: #0056b3;
}
</style>
{% endblock %}
