{% extends "base.html" %}

{% block title %}USB-C Pr√ºfung{% endblock %}

{% block content %}
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USB-C Pr√ºfungen - Benning Device Manager</title>
    
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="page-header">
            <div class="header-content">
                <h1>üîå USB-C Kabel-Pr√ºfungen</h1>
                <nav class="breadcrumb">
                    <a href="/">Dashboard</a>
                    <span>‚Üí</span>
                    <span>USB-C Pr√ºfungen</span>
                </nav>
            </div>
        </header>

        <!-- Statistiken -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-content">
                    <div class="stat-value">{{ inspections|length }}</div>
                    <div class="stat-label">Gesamt Pr√ºfungen</div>
                </div>
            </div>

            <div class="stat-card stat-success">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-content">
                    <div class="stat-value">
                        {{ inspections|selectattr('result', 'equalto', 'bestanden')|list|length }}
                    </div>
                    <div class="stat-label">Bestanden</div>
                </div>
            </div>

            <div class="stat-card stat-danger">
                <div class="stat-icon">‚ùå</div>
                <div class="stat-content">
                    <div class="stat-value">
                        {{ inspections|selectattr('result', 'equalto', 'nicht_bestanden')|list|length }}
                    </div>
                    <div class="stat-label">Nicht bestanden</div>
                </div>
            </div>

            <div class="stat-card stat-warning">
                <div class="stat-icon">‚è≥</div>
                <div class="stat-content">
                    <div class="stat-value">
                        {{ inspections|selectattr('result', 'equalto', 'in_bearbeitung')|list|length }}
                    </div>
                    <div class="stat-label">In Bearbeitung</div>
                </div>
            </div>
        </div>

        <!-- Filter -->
        <div class="filter-bar">
            <input type="text" id="searchInput" placeholder="üîç Suche nach Ger√§te-ID, Pr√ºfer..." class="search-input">
            <select id="resultFilter" class="filter-select">
                <option value="">Alle Ergebnisse</option>
                <option value="bestanden">‚úÖ Bestanden</option>
                <option value="nicht_bestanden">‚ùå Nicht bestanden</option>
                <option value="in_bearbeitung">‚è≥ In Bearbeitung</option>
            </select>
        </div>

        <!-- Pr√ºfungsliste -->
        <div class="card">
            <div class="card-header">
                <h2>Pr√ºfungsliste</h2>
            </div>
            <div class="card-body">
                {% if inspections %}
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Pr√ºf-ID</th>
                                <th>Ger√§te-ID</th>
                                <th>Datum</th>
                                <th>Pr√ºfer</th>
                                <th>Protokolle</th>
                                <th>eMarker</th>
                                <th>Ergebnis</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="inspectionTableBody">
                            {% for inspection in inspections %}
                            <tr data-result="{{ inspection.result }}">
                                <td><strong>#{{ inspection.id }}</strong></td>
                                <td>
                                    <a href="/device/{{ inspection.device_id }}" class="device-link">
                                        {{ inspection.device_id }}
                                    </a>
                                </td>
                                <td>{{ inspection.inspection_date.strftime('%d.%m.%Y %H:%M') if inspection.inspection_date else 'N/A' }}</td>
                                <td>{{ inspection.inspector or 'N/A' }}</td>
                                <td>
                                    <span class="badge badge-info">
                                        {{ inspection.protocols_tested.split(',')|length if inspection.protocols_tested else 0 }}
                                    </span>
                                </td>
                                <td>
                                    {% if inspection.emarker_present %}
                                    <span class="badge badge-success">‚úì Ja</span>
                                    {% else %}
                                    <span class="badge badge-secondary">- Nein</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if inspection.result == 'bestanden' %}
                                    <span class="badge badge-success">‚úÖ Bestanden</span>
                                    {% elif inspection.result == 'nicht_bestanden' %}
                                    <span class="badge badge-danger">‚ùå Nicht bestanden</span>
                                    {% else %}
                                    <span class="badge badge-warning">‚è≥ In Bearbeitung</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <a href="/device/{{ inspection.device_id }}/usbc-inspection/{{ inspection.id }}" 
                                           class="btn btn-sm btn-primary" title="Details ansehen">
                                            üëÅÔ∏è
                                        </a>
                                        <a href="/device/{{ inspection.device_id }}/usbc-inspection?copy={{ inspection.id }}" 
                                           class="btn btn-sm btn-secondary" title="Kopieren">
                                            üìã
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üì≠</div>
                    <h3>Keine Pr√ºfungen vorhanden</h3>
                    <p>Es wurden noch keine USB-C Kabel-Pr√ºfungen durchgef√ºhrt.</p>
                    <a href="/devices" class="btn btn-primary">Ger√§te ansehen</a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Footer -->
        <footer class="page-footer">
            <p>&copy; 2026 Benning Device Manager | USB-C Kabel-Pr√ºfung</p>
        </footer>
    </div>

    <script>
        // Suchfunktion
        document.getElementById('searchInput').addEventListener('input', filterTable);
        document.getElementById('resultFilter').addEventListener('change', filterTable);

        function filterTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const resultFilter = document.getElementById('resultFilter').value;
            const rows = document.querySelectorAll('#inspectionTableBody tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const result = row.dataset.result;

                const matchesSearch = text.includes(searchTerm);
                const matchesFilter = !resultFilter || result === resultFilter;

                row.style.display = (matchesSearch && matchesFilter) ? '' : 'none';
            });
        }
    </script>
</body>
</html>

{% endblock %}
